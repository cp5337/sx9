# TOML Output & Training Cost

**Date:** 2025-12-07

---

## üìÑ **TOML OUTPUT STATUS**

### **Current DSL Pipeline Output:**
The `yaml_dsl_pipeline.py` currently saves:
- ‚úÖ **YAML:** `sx9_entities.yaml` (main output)
- ‚úÖ **JSON:** `sx9_entities.json` (compatibility)
- ‚ùå **TOML:** NOT currently saved by DSL pipeline

### **Where TOML IS Generated:**
TOML files ARE generated by:
- ‚úÖ `match_tools_to_ctas_tasks.py` - Generates `tools_tasks_matching.toml`
- ‚úÖ Other matching/export scripts

### **Should DSL Pipeline Save TOML?**
**YES** - According to `THREAT_INTELLIGENCE_DATA_FLOW.md`, the pipeline should output in **TOML and JSON formats**.

**Action Needed:** Add TOML output to `yaml_dsl_pipeline.py` `save_results()` method.

---

## üí∞ **ML TRAINING COST**

### **Training Components:**
1. **DistilBERT** - MITRE Classification
2. **Phi-3 LoRA** - Threat Intelligence Explanation  
3. **GNN** - Threat Graph Analysis

### **Cost Breakdown (Lambda Labs H100 - Recommended):**

| Model | Training Time | GPU Cost (H100 @ $3.29/hr) |
|-------|---------------|----------------------------|
| **DistilBERT** | 4-6 hours | **$13.16 - $19.74** |
| **Phi-3 LoRA** | 8-12 hours | **$26.32 - $39.48** |
| **GNN** | 12-18 hours | **$39.48 - $59.22** |
| **TOTAL (Sequential)** | 24-36 hours | **$78.96 - $118.44** |

### **Parallel Training (3x H100 GPUs):**
- **Time:** 18 hours (longest model)
- **Cost:** **$177.66** (3x H100 @ $3.29/hr √ó 18 hrs)
- **Best Value:** Train all 3 models simultaneously

### **Alternative Options:**

#### **AWS EC2 H100 Spot (Budget):**
- **Cost:** **$124.62 - $151.89** (60% savings)
- **Risk:** Spot interruption possible

#### **AWS EC2 H100 On-Demand (Fastest):**
- **Cost:** **$288.06 - $356.19**
- **Time:** 12-15 hours (faster GPUs)

#### **GCP A100 (Budget):**
- **Cost:** **$277.74** (sequential or parallel)
- **Time:** 48-72 hours (sequential) or 24 hours (parallel)

### **Storage Costs (3 months):**
- **GCP:** $13.50
- **AWS:** $15.54
- **Azure:** $12.15

### **TOTAL COST ESTIMATE:**

| Option | GPU Cost | Storage | **TOTAL** |
|--------|----------|---------|-----------|
| **Lambda Labs H100 (Parallel)** | $177.66 | $13.50 | **$191.16** ‚≠ê |
| **AWS EC2 H100 Spot (Parallel)** | $136.35 | $15.54 | **$151.89** |
| **AWS EC2 H100 On-Demand** | $272.52 | $15.54 | **$288.06** |
| **GCP A100 (Parallel)** | $264.24 | $13.50 | **$277.74** |

**Recommended:** Lambda Labs H100 Parallel Training = **~$191**

---

## ‚úÖ **SUMMARY**

1. **TOML Output:** Currently NOT saved by DSL pipeline - needs to be added
2. **Training Cost:** **~$150-300** depending on provider and approach
3. **Best Value:** Lambda Labs H100 parallel training = **~$191**


1